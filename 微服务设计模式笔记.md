# 第3章 微服务架构中进程间通信

## 

> 基于同步和基于异步的通信

# 基于同步远程过程调用技术

## 服务发现技术

- 背景：由于服务组件需要自动扩展故障转移升级等，服务实例集会动态改变，ip也会动态变化，必须使用服务发现

- 关键组件：服务注册表，即包含实例网络位置信息的数据库

- 服务发现实现的两种方法：

  - 应用层服务发现

    - 服务自注册，客户端与服务注册表交互：客户端可以缓存服务地址；服务自注册可以用心跳来检查是否过期

    ![image-20201117224210909](/Users/clannd/Library/Application Support/typora-user-images/image-20201117224210909.png)

  - 平台层服务发现模式

    ![image-20201118222229233](/Users/clannd/Library/Application Support/typora-user-images/image-20201118222229233.png)

  

## Rest API 的优缺点

- 优点：

  - 对防火墙友好
  - 不需要中间代理
  - 支持请求/响应的通信
  - curl命令测试

- 缺点：

  - 只支持请求/响应的通信
  - 需要两边在线，可用性低，没有代理缓冲消息
  - 客户端必须知道实例的位置，借助服务发现技术

  

  ## 基于异步消息模式的通信

  > 消息通道：点对点；发布订阅

  - 消息机制的交互方式：

    - 请求/响应和异步请求/响应

    - 单向通知

    - 发布/订阅

    - 发布/异步响应

      第一种+第三种：消息的头部指定回复通道，同时也是发布/订阅通道，消费者将相关性ID写入回复通道

  - 异步API

    - 基于代理的消息
    - ![image-20201118230251418](/Users/clannd/Library/Application Support/typora-user-images/image-20201118230251418.png)

    







